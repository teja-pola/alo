{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\dteja\\\\OneDrive\\\\Desktop\\\\TEJA\\\\ALO\\\\frontend\\\\src\\\\pages\\\\Checkout.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Elements } from '@stripe/react-stripe-js';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { useCheckout } from '../context/CheckoutContext';\nimport { useAuth } from '../hooks/useAuth';\nimport { getRestaurantMealPlans } from '../services/restaurant';\nimport { payment } from '../services/payment';\nimport CheckoutLayout from '../components/checkout/CheckoutLayout';\nimport PlanSelection from '../components/checkout/PlanSelection';\nimport DeliveryDetails from '../components/checkout/DeliveryDetails';\nimport PaymentForm from '../components/checkout/PaymentForm';\nimport OrderConfirmation from '../components/checkout/OrderConfirmation';\n\n// Initialize Stripe\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\nconst Checkout = () => {\n  _s();\n  const {\n    mealPlanId\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    user\n  } = useAuth();\n  const {\n    state: {\n      mealPlan,\n      selectedOptions,\n      deliveryDetails,\n      currentStep\n    },\n    setMealPlan,\n    setSelectedOptions,\n    setDeliveryDetails,\n    completeCheckout\n  } = useCheckout();\n\n  // Add error state for Stripe\n  const [stripeError, setStripeError] = useState(null);\n  useEffect(() => {\n    // Check Stripe configuration\n    if (!process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY) {\n      setStripeError('Stripe configuration is missing');\n    }\n  }, []);\n  useEffect(() => {\n    const fetchMealPlan = async () => {\n      try {\n        const response = await getRestaurantMealPlans(mealPlanId);\n        setMealPlan(response.data);\n      } catch (error) {\n        console.error('Failed to fetch meal plan:', error);\n        navigate('/');\n      }\n    };\n    if (!user) {\n      navigate('/login', {\n        state: {\n          from: `/checkout/${mealPlanId}`\n        }\n      });\n      return;\n    }\n    if (mealPlanId && !mealPlan) {\n      fetchMealPlan();\n    }\n  }, [mealPlanId, user, navigate, mealPlan, setMealPlan]);\n  const handlePlanSelection = options => {\n    setSelectedOptions(options);\n  };\n  const handleDeliveryDetails = details => {\n    setDeliveryDetails(details);\n  };\n  const handlePayment = async paymentDetails => {\n    try {\n      let paymentResult;\n      if (paymentDetails.type === 'card') {\n        // Handle Stripe payment\n        const paymentIntent = await payment.createPaymentIntent({\n          amount: selectedOptions.price,\n          currency: 'inr',\n          paymentMethodId: paymentDetails.paymentMethodId\n        });\n        paymentResult = await payment.confirmPayment(paymentIntent.id, paymentDetails.paymentMethodId);\n      } else if (paymentDetails.type === 'upi') {\n        // Handle UPI payment\n        paymentResult = await payment.initiateUPIPayment({\n          amount: selectedOptions.price,\n          mealPlanId,\n          selectedOptions,\n          deliveryDetails\n        });\n      } else {\n        // Handle COD\n        paymentResult = {\n          success: true,\n          orderId: 'COD-' + Date.now()\n        };\n      }\n      if (paymentResult.success) {\n        completeCheckout();\n      }\n    } catch (error) {\n      console.error('Payment failed:', error);\n      // Handle payment error (show error message, etc.)\n    }\n  };\n  if (!mealPlan) {\n    return null; // Or loading spinner\n  }\n  const renderStep = () => {\n    switch (currentStep) {\n      case 'plan':\n        return /*#__PURE__*/_jsxDEV(PlanSelection, {\n          mealPlan: mealPlan,\n          onNext: handlePlanSelection\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 11\n        }, this);\n      case 'details':\n        return /*#__PURE__*/_jsxDEV(DeliveryDetails, {\n          deliveryOption: selectedOptions.deliveryOption,\n          onBack: () => navigate(-1),\n          onNext: handleDeliveryDetails\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 11\n        }, this);\n      case 'payment':\n        return /*#__PURE__*/_jsxDEV(Elements, {\n          stripe: stripePromise,\n          children: /*#__PURE__*/_jsxDEV(PaymentForm, {\n            amount: selectedOptions.price,\n            onBack: () => navigate(-1),\n            onNext: handlePayment\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 131,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 11\n        }, this);\n      case 'confirmation':\n        return /*#__PURE__*/_jsxDEV(OrderConfirmation, {\n          orderDetails: {\n            orderId: 'ORD-' + Date.now(),\n            // Replace with actual order ID\n            restaurant: mealPlan.restaurant,\n            mealPlan,\n            selectedOptions,\n            deliveryDetails,\n            amount: selectedOptions.price,\n            startDate: new Date().toISOString()\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this);\n      default:\n        return null;\n    }\n  };\n\n  // Handle Stripe error in the render\n  if (stripeError) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-red-600 p-4 bg-red-50 rounded-md\",\n      children: [\"Error: \", stripeError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(CheckoutLayout, {\n    currentStep: currentStep,\n    children: renderStep()\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 5\n  }, this);\n};\n_s(Checkout, \"TaJfrQa+n0gR+eNTNhIqqINFjxI=\", false, function () {\n  return [useParams, useNavigate, useAuth, useCheckout];\n});\n_c = Checkout;\nexport default Checkout;\nvar _c;\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","Elements","loadStripe","useCheckout","useAuth","getRestaurantMealPlans","payment","CheckoutLayout","PlanSelection","DeliveryDetails","PaymentForm","OrderConfirmation","jsxDEV","_jsxDEV","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","Checkout","_s","mealPlanId","navigate","user","state","mealPlan","selectedOptions","deliveryDetails","currentStep","setMealPlan","setSelectedOptions","setDeliveryDetails","completeCheckout","stripeError","setStripeError","REACT_APP_STRIPE_PUBLISHABLE_KEY","fetchMealPlan","response","data","error","console","from","handlePlanSelection","options","handleDeliveryDetails","details","handlePayment","paymentDetails","paymentResult","type","paymentIntent","createPaymentIntent","amount","price","currency","paymentMethodId","confirmPayment","id","initiateUPIPayment","success","orderId","Date","now","renderStep","onNext","fileName","_jsxFileName","lineNumber","columnNumber","deliveryOption","onBack","stripe","children","orderDetails","restaurant","startDate","toISOString","className","_c","$RefreshReg$"],"sources":["C:/Users/dteja/OneDrive/Desktop/TEJA/ALO/frontend/src/pages/Checkout.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { Elements } from '@stripe/react-stripe-js';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { useCheckout } from '../context/CheckoutContext';\r\nimport { useAuth } from '../hooks/useAuth';\r\nimport { getRestaurantMealPlans } from '../services/restaurant';\r\nimport { payment } from '../services/payment';\r\nimport CheckoutLayout from '../components/checkout/CheckoutLayout';\r\nimport PlanSelection from '../components/checkout/PlanSelection';\r\nimport DeliveryDetails from '../components/checkout/DeliveryDetails';\r\nimport PaymentForm from '../components/checkout/PaymentForm';\r\nimport OrderConfirmation from '../components/checkout/OrderConfirmation';\r\n\r\n// Initialize Stripe\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\r\n\r\nconst Checkout = () => {\r\n  const { mealPlanId } = useParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const {\r\n    state: { mealPlan, selectedOptions, deliveryDetails, currentStep },\r\n    setMealPlan,\r\n    setSelectedOptions,\r\n    setDeliveryDetails,\r\n    completeCheckout,\r\n  } = useCheckout();\r\n\r\n  // Add error state for Stripe\r\n  const [stripeError, setStripeError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    // Check Stripe configuration\r\n    if (!process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY) {\r\n      setStripeError('Stripe configuration is missing');\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const fetchMealPlan = async () => {\r\n      try {\r\n        const response = await getRestaurantMealPlans(mealPlanId);\r\n        setMealPlan(response.data);\r\n      } catch (error) {\r\n        console.error('Failed to fetch meal plan:', error);\r\n        navigate('/');\r\n      }\r\n    };\r\n\r\n    if (!user) {\r\n      navigate('/login', { state: { from: `/checkout/${mealPlanId}` } });\r\n      return;\r\n    }\r\n\r\n    if (mealPlanId && !mealPlan) {\r\n      fetchMealPlan();\r\n    }\r\n  }, [mealPlanId, user, navigate, mealPlan, setMealPlan]);\r\n\r\n  const handlePlanSelection = (options) => {\r\n    setSelectedOptions(options);\r\n  };\r\n\r\n  const handleDeliveryDetails = (details) => {\r\n    setDeliveryDetails(details);\r\n  };\r\n\r\n  const handlePayment = async (paymentDetails) => {\r\n    try {\r\n      let paymentResult;\r\n\r\n      if (paymentDetails.type === 'card') {\r\n        // Handle Stripe payment\r\n        const paymentIntent = await payment.createPaymentIntent({\r\n          amount: selectedOptions.price,\r\n          currency: 'inr',\r\n          paymentMethodId: paymentDetails.paymentMethodId,\r\n        });\r\n\r\n        paymentResult = await payment.confirmPayment(\r\n          paymentIntent.id,\r\n          paymentDetails.paymentMethodId\r\n        );\r\n      } else if (paymentDetails.type === 'upi') {\r\n        // Handle UPI payment\r\n        paymentResult = await payment.initiateUPIPayment({\r\n          amount: selectedOptions.price,\r\n          mealPlanId,\r\n          selectedOptions,\r\n          deliveryDetails,\r\n        });\r\n      } else {\r\n        // Handle COD\r\n        paymentResult = { success: true, orderId: 'COD-' + Date.now() };\r\n      }\r\n\r\n      if (paymentResult.success) {\r\n        completeCheckout();\r\n      }\r\n    } catch (error) {\r\n      console.error('Payment failed:', error);\r\n      // Handle payment error (show error message, etc.)\r\n    }\r\n  };\r\n\r\n  if (!mealPlan) {\r\n    return null; // Or loading spinner\r\n  }\r\n\r\n  const renderStep = () => {\r\n    switch (currentStep) {\r\n      case 'plan':\r\n        return (\r\n          <PlanSelection\r\n            mealPlan={mealPlan}\r\n            onNext={handlePlanSelection}\r\n          />\r\n        );\r\n      case 'details':\r\n        return (\r\n          <DeliveryDetails\r\n            deliveryOption={selectedOptions.deliveryOption}\r\n            onBack={() => navigate(-1)}\r\n            onNext={handleDeliveryDetails}\r\n          />\r\n        );\r\n      case 'payment':\r\n        return (\r\n          <Elements stripe={stripePromise}>\r\n            <PaymentForm\r\n              amount={selectedOptions.price}\r\n              onBack={() => navigate(-1)}\r\n              onNext={handlePayment}\r\n            />\r\n          </Elements>\r\n        );\r\n      case 'confirmation':\r\n        return (\r\n          <OrderConfirmation\r\n            orderDetails={{\r\n              orderId: 'ORD-' + Date.now(), // Replace with actual order ID\r\n              restaurant: mealPlan.restaurant,\r\n              mealPlan,\r\n              selectedOptions,\r\n              deliveryDetails,\r\n              amount: selectedOptions.price,\r\n              startDate: new Date().toISOString(),\r\n            }}\r\n          />\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  // Handle Stripe error in the render\r\n  if (stripeError) {\r\n    return (\r\n      <div className=\"text-red-600 p-4 bg-red-50 rounded-md\">\r\n        Error: {stripeError}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <CheckoutLayout currentStep={currentStep}>\r\n      {renderStep()}\r\n    </CheckoutLayout>\r\n  );\r\n};\r\n\r\nexport default Checkout; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}